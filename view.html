<!DOCTYPE html>
<html>
<head>
    <title>Live Network View</title>
    <style>
        body { margin: 0; background: #ffffff; color: white; font-family: sans-serif; }
        #map-container { 
            width: 4000px; height: 2000px; 
            background: url('map.svg') no-repeat;
            background-size: contain;
            position: relative;
            margin: 20px auto;
         
        }
        .city-label { position: absolute; font-size: 11px; font-weight: bold; background: rgba(0,0,0,0.6); padding: 2px 4px; border-radius: 3px; pointer-events: none; }
        .plane { position: absolute; font-size: 22px; z-index: 10; margin-left: -11px; margin-top: -11px; }

        @keyframes flyLoop {
            0% { transform: translate(var(--x1), var(--y1)) rotate(var(--angle)); }
            45% { transform: translate(var(--x2), var(--y2)) rotate(var(--angle)); }
            50% { transform: translate(var(--x2), var(--y2)) rotate(var(--rev-angle)); }
            95% { transform: translate(var(--x1), var(--y1)) rotate(var(--rev-angle)); }
            100% { transform: translate(var(--x1), var(--y1)) rotate(var(--angle)); }
        }
    </style>
</head>
<body>
    <div id="map-container"></div>

    <script>
        function init() {
            const container = document.getElementById('map-container');
            const routes = JSON.parse(localStorage.getItem('airlineRoutes')) || [];
            container.innerHTML = '';

            routes.forEach(r => {
                // Create Labels
                addLabel(r.a, r.ax, r.ay);
                addLabel(r.b, r.bx, r.by);

                // Calculate Angle for the plane to face the right way
                const angle = Math.atan2(r.by - r.ay, r.bx - r.ax) * 180 / Math.PI;
                
                // Create Plane
                const plane = document.createElement('div');
                plane.className = 'plane';
                plane.innerHTML = '✈️';
                
                // Set CSS variables for the animation
                plane.style.setProperty('--x1', r.ax + 'px');
                plane.style.setProperty('--y1', r.ay + 'px');
                plane.style.setProperty('--x2', r.bx + 'px');
                plane.style.setProperty('--y2', r.by + 'px');
                plane.style.setProperty('--angle', (angle + 45) + 'deg');
                plane.style.setProperty('--rev-angle', (angle + 225) + 'deg');
                
                plane.style.animation = `flyLoop 10s linear infinite`;
                container.appendChild(plane);
            });
        }

        function addLabel(text, x, y) {
            const lbl = document.createElement('div');
            lbl.className = 'city-label';
            lbl.style.left = x + 'px';
            lbl.style.top = (y + 10) + 'px';
            lbl.innerText = text;
            document.getElementById('map-container').appendChild(lbl);
        }

        // Run once on load
        init();
        
        // Listen for storage changes (happens when you save in the other tab)
        window.addEventListener('storage', init);
    </script>
</body>
</html>
