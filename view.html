<!DOCTYPE html>
<html>
<head>
    <title>Live Network View</title>
    <style>
        body { margin: 0; background: #001220; overflow: hidden; }
        #map-container { 
            width: 1200px; height: 800px; 
            background: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/World_map_blank_without_borders.svg') no-repeat;
            background-size: contain;
            position: relative;
            margin: auto;
            border: 1px solid #333;
        }
        .city-label { position: absolute; color: white; font-size: 12px; font-weight: bold; text-shadow: 1px 1px 2px black; }
        .plane { position: absolute; font-size: 20px; z-index: 10; transition: all 5s linear; }
    </style>
</head>
<body>
    <div id="map-container" id="map"></div>

    <script>
        const container = document.getElementById('map-container');

        function drawNetwork() {
            container.innerHTML = '';
            const routes = JSON.parse(localStorage.getItem('airlineRoutes')) || [];
            
            routes.forEach((r, i) => {
                // Add City Labels
                createLabel(r.a, r.ax, r.ay);
                createLabel(r.b, r.bx, r.by);
                
                // Add Plane
                const plane = document.createElement('div');
                plane.className = 'plane';
                plane.innerHTML = '✈️';
                plane.style.left = r.ax + 'px';
                plane.style.top = r.ay + 'px';
                container.appendChild(plane);

                // Flight Loop Logic
                let toB = true;
                setInterval(() => {
                    if(toB) {
                        plane.style.left = r.bx + 'px';
                        plane.style.top = r.by + 'px';
                        plane.style.transform = 'rotate(45deg)'; 
                    } else {
                        plane.style.left = r.ax + 'px';
                        plane.style.top = r.ay + 'px';
                        plane.style.transform = 'rotate(225deg)';
                    }
                    toB = !toB;
                }, 6000);
            });
        }

        function createLabel(text, x, y) {
            const div = document.createElement('div');
            div.className = 'city-label';
            div.style.left = x + 'px';
            div.style.top = (y - 15) + 'px';
            div.innerText = text;
            container.appendChild(div);
        }

        drawNetwork();
        // Refresh every 5 seconds to catch new routes added in the other tab
        setInterval(drawNetwork, 5000);
    </script>
</body>
</html>
