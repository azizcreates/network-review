<!DOCTYPE html>
<html>
<head>
    <title>Network Manager</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; gap: 20px; padding: 20px; background: #f0f2f5; }
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 350px; }
        .route-item { border-bottom: 1px solid #eee; padding: 10px 0; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
        input { margin-bottom: 10px; padding: 8px; width: calc(100% - 20px); border: 1px solid #ddd; border-radius: 4px; }
        .coord-group { display: flex; gap: 5px; margin-bottom: 10px; }
        .coord-group input { width: 45%; }
        button { padding: 10px; cursor: pointer; border-radius: 4px; border: none; transition: 0.2s; font-weight: bold; }
        .btn-add { background: #28a745; color: white; width: 100%; }
        .btn-del { background: #dc3545; color: white; font-size: 11px; padding: 5px 8px; }
        .btn-add:hover { background: #218838; }
        .btn-add:disabled { background: #ccc; cursor: not-allowed; }
        hr { border: 0; border-top: 1px solid #eee; margin: 15px 0; }
        #status-msg { font-size: 12px; color: #666; margin-top: 10px; text-align: center; }
    </style>
</head>
<body>
    <div class="panel">
        <h2>Add New Route</h2>
        <label>City A</label>
        <input type="text" id="cityA" placeholder="Name (e.g. JED)">
        <div class="coord-group">
            <input type="number" id="ax" placeholder="X Coord"> 
            <input type="number" id="ay" placeholder="Y Coord">
        </div>
        <hr>
        <label>City B</label>
        <input type="text" id="cityB" placeholder="Name (e.g. RUH)">
        <div class="coord-group">
            <input type="number" id="bx" placeholder="X Coord"> 
            <input type="number" id="by" placeholder="Y Coord">
        </div>
        <button id="addBtn" class="btn-add" onclick="addRoute()">Add Route</button>
        <div id="status-msg">Ready</div>
    </div>

    <div class="panel" style="flex-grow: 1;">
        <h2>Active Routes (Cloud)</h2>
        <div id="routeList">Loading cloud data...</div>
        <br>
        <a href="view.html" target="_blank" style="color: #0052cc; font-weight: bold; text-decoration: none;">View Live Map →</a>
    </div>

    <script>
        // YOUR UNIQUE GOOGLE LINK
        const SHEET_URL = "https://script.google.com/macros/s/AKfycbxCNjNehg9DqxbLY8kFtRaTVftJYot8Lk_QcxyofrwcmvU_BuuRnEZLVlHeQxGeD9Ns/exec";
        
        let routes = [];

        // 1. Load data from Cloud on startup
        async function fetchFromCloud() {
            try {
                const response = await fetch(SHEET_URL);
                routes = await response.json();
                renderRoutes();
            } catch (e) {
                document.getElementById('routeList').innerText = "Error loading data.";
            }
        }

        // 2. Save data to Cloud
        async function saveToCloud() {
            const btn = document.getElementById('addBtn');
            const status = document.getElementById('status-msg');
            
            btn.disabled = true;
            status.innerText = "Saving to Cloud...";

            try {
                await fetch(SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Essential for Google Apps Script
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(routes)
                });
                status.innerText = "Saved Successfully!";
                setTimeout(() => { status.innerText = "Ready"; }, 2000);
            } catch (e) {
                alert("Failed to save to cloud.");
                status.innerText = "Error";
            } finally {
                btn.disabled = false;
            }
        }

        function renderRoutes() {
            const list = document.getElementById('routeList');
            list.innerHTML = routes.length === 0 ? '<p style="color:gray">No routes found.</p>' : '';
            routes.forEach((r, index) => {
                list.innerHTML += `
                    <div class="route-item">
                        <span><strong>${r.a} ✈ ${r.b}</strong><br><small>${r.ax},${r.ay} → ${r.bx},${r.by}</small></span>
                        <button class="btn-del" onclick="deleteRoute(${index})">Delete</button>
                    </div>`;
            });
        }

        async function addRoute() {
            const r = {
                a: document.getElementById('cityA').value,
                ax: parseInt(document.getElementById('ax').value),
                ay: parseInt(document.getElementById('ay').value),
                b: document.getElementById('cityB').value,
                bx: parseInt(document.getElementById('bx').value),
                by: parseInt(document.getElementById('by').value)
            };

            if (!r.a || isNaN(r.ax) || !r.b || isNaN(r.bx)) {
                alert("Please fill in all fields.");
                return;
            }

            routes.push(r);
            renderRoutes();
            await saveToCloud(); // Send to Google Sheet

            // Clear inputs
            document.querySelectorAll('input').forEach(i => i.value = '');
        }

        async function deleteRoute(index) {
            if(confirm("Delete this route from the cloud?")) {
                routes.splice(index, 1);
                renderRoutes();
                await saveToCloud(); // Update Google Sheet
            }
        }

        // Initialize
        fetchFromCloud();
    </script>
</body>
</html>
