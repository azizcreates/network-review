<!DOCTYPE html>
<html>
<head>
    <title>Live Network View - With Rulers</title>
    <style>
        body { margin: 0; background: #ffffff; color: white; font-family: sans-serif; overflow: auto; }
        
        #map-container { 
            width: 4000px; /* Adjust to your map.svg width */
            height: 2000px; /* Adjust to your map.svg height */
            background: url('map.svg') no-repeat;
            background-size: contain;
            position: relative;
            margin: 40px auto; /* Margin for ruler labels */
            border: 1px solid #444;
            cursor: crosshair;
        }

        /* The Ruler Grid */
        .ruler-x, .ruler-y {
            position: absolute;
            background: rgba(0, 255, 255, 0.2);
            pointer-events: none;
        }
        .ruler-x { width: 1px; height: 100%; }
        .ruler-y { height: 1px; width: 100%; }

        /* Coordinate Label following mouse */
        #coord-tracker {
            position: fixed;
            background: rgba(255, 255, 0, 0.9);
            color: black;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .city-label { position: absolute; font-size: 11px; font-weight: bold; background: rgba(0,0,0,0.7); padding: 2px 4px; border-radius: 3px; z-index: 5; }
        .plane { position: absolute; font-size: 22px; z-index: 10; margin-left: -11px; margin-top: -11px; }

@keyframes flyToB {
        0% { transform: translate(var(--x1), var(--y1)) rotate(var(--angle)); }
        100% { transform: translate(var(--x2), var(--y2)) rotate(var(--angle)); }
    }
    @keyframes flyToA {
        0% { transform: translate(var(--x2), var(--y2)) rotate(var(--rev-angle)); }
        100% { transform: translate(var(--x1), var(--y1)) rotate(var(--rev-angle)); }
    }

    .plane { 
        position: absolute; 
        font-size: 22px; 
        z-index: 10; 
        margin-left: -11px; 
        margin-top: -11px; 
        transition: opacity 0.5s;
    }
    </style>
</head>
<body>

    <div id="coord-tracker">X: 0, Y: 0</div>

    <div id="map-container">
        </div>

    <script>
const container = document.getElementById('map-container');
    const SPEED = 50; // Pixels per second. Change this to make all planes faster/slower.

    function drawNetwork() {
        const elementsToRemove = container.querySelectorAll('.city-label, .plane');
        elementsToRemove.forEach(el => el.remove());

        const routes = JSON.parse(localStorage.getItem('airlineRoutes')) || [];
        
        routes.forEach(r => {
            addLabel(r.a, r.ax, r.ay);
            addLabel(r.b, r.bx, r.by);

            // 1. Calculate Distance
            const dx = r.bx - r.ax;
            const dy = r.by - r.ay;
            const distance = Math.sqrt(dx * dx + dy * dy);

            // 2. Calculate Duration (Time = Distance / Speed)
            const duration = distance / SPEED;

            // 3. Calculate Angles
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            const revAngle = angle + 180;

            // 4. Create Plane
            const plane = document.createElement('div');
            plane.className = 'plane';
            plane.innerHTML = '✈️';
            
            // Set CSS Variables
            plane.style.setProperty('--x1', r.ax + 'px');
            plane.style.setProperty('--y1', r.ay + 'px');
            plane.style.setProperty('--x2', r.bx + 'px');
            plane.style.setProperty('--y2', r.by + 'px');
            plane.style.setProperty('--angle', (angle + 45) + 'deg');
            plane.style.setProperty('--rev-angle', (revAngle + 45) + 'deg');

            container.appendChild(plane);

            // 5. Unified Speed Animation Logic
            function startFlight() {
                // Fly to B
                plane.style.animation = `flyToB ${duration}s linear forwards`;
                
                setTimeout(() => {
                    // Stay at City B for 2 seconds (Turnaround time)
                    setTimeout(() => {
                        // Fly back to A
                        plane.style.animation = `flyToA ${duration}s linear forwards`;
                        
                        setTimeout(() => {
                            // Stay at City A for 2 seconds, then repeat
                            setTimeout(startFlight, 2000);
                        }, duration * 1000);
                    }, 2000);
                }, duration * 1000);
            }

            // Start each plane with a random delay so they don't launch together
            const randomStartDelay = Math.random() * 5000; 
            setTimeout(startFlight, randomStartDelay);
        });
    }

        function addLabel(text, x, y) {
            const lbl = document.createElement('div');
            lbl.className = 'city-label';
            lbl.style.left = x + 'px';
            lbl.style.top = (y + 12) + 'px';
            lbl.innerText = text;
            container.appendChild(lbl);
        }

        createRulers();
        drawNetwork();
        window.addEventListener('storage', drawNetwork);
    </script>
</body>
</html>
