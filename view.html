<!DOCTYPE html>
<html>
<head>
    <title>Network Live Map</title>
    <style>
        body { margin: 0; background: #281536; color: white; font-family: 'Segoe UI', sans-serif; overflow: auto; }
        
        header { 
            background: #522d6d; padding: 15px 40px; display: flex; align-items: center; 
            border-bottom: 2px solid #CDDE00; position: fixed; top: 0; left: 0; width: 100%; 
            box-sizing: border-box; z-index: 1000; 
        }
        
        .logo { height: 50px; width: auto; margin-right: 20px; }
        .branding h1 { margin: 0; font-size: 24px; color: #CDDE00; }
        .branding p { margin: 0; font-size: 13px; color: #ffffff; opacity: 0.8; }

        #map-container { 
            width: 3600px; height: 2000px; background: url('map.svg') no-repeat; 
            background-size: contain; position: relative; margin: 120px 40px 60px 40px; 
            border: 1px solid #333; 
        }

        /* CITY DOTS */
        .city-dot {
            position: absolute; width: 10px; height: 10px; background: #CDDE00;
            border-radius: 50%; z-index: 15; transform: translate(-50%, -50%);
            box-shadow: 0 0 10px #CDDE00;
        }

        .city-label { 
            position: absolute; font-size: 11px; font-weight: bold; background: rgba(0,0,0,0.8); 
            padding: 2px 6px; border-radius: 3px; z-index: 10; white-space: nowrap; 
            transform: translateX(-50%);
        }
        
        /* THE OLD STYLE PLANE CSS */
        .plane { 
            position: absolute; 
            font-size: 24px; 
            z-index: 20; 
            margin-left: -12px; 
            margin-top: -12px; 
            pointer-events: none; 
            text-shadow: 0 0 10px #CDDE00;
            /* This is the secret to the old animation smoothness */
            transition: all 6s linear; 
        }
    </style>
</head>
<body>
    <header>
        <img src="logo.svg" alt="Logo" class="logo">
        <div class="branding">
            <h1>Network Live Map</h1>
            <p>Developed & Designed by Abdulaziz Salamah</p>
        </div>
    </header>

    <div id="map-container"></div>

    <script>
        const SHEET_URL = "https://script.google.com/macros/s/AKfycbxCNjNehg9DqxbLY8kFtRaTVftJYot8Lk_QcxyofrwcmvU_BuuRnEZLVlHeQxGeD9Ns/exec";
        const container = document.getElementById('map-container');
        
        async function drawNetwork() {
            try {
                const response = await fetch(SHEET_URL);
                const routes = await response.json();
                
                // Clear the map
                container.innerHTML = '';

                routes.forEach(r => {
                    // 1. Create Labels and Dots
                    addCity(r.a, r.ax, r.ay);
                    addCity(r.b, r.bx, r.by);

                    // 2. Create the Plane
                    const plane = document.createElement('div');
                    plane.className = 'plane'; 
                    plane.innerHTML = '✈️';
                    
                    // Start at City A
                    plane.style.left = r.ax + 'px';
                    plane.style.top = r.ay + 'px';
                    container.appendChild(plane);

                    // 3. The Toggle Logic (Old Style)
                    let toB = true;
                    
                    // We use a small timeout to let the browser "register" the starting position
                    setTimeout(() => {
                        function move() {
                            if(toB) {
                                plane.style.left = r.bx + 'px';
                                plane.style.top = r.by + 'px';
                                plane.style.transform = 'rotate(45deg)'; 
                            } else {
                                plane.style.left = r.ax + 'px';
                                plane.style.top = r.ay + 'px';
                                plane.style.transform = 'rotate(225deg)';
                            }
                            toB = !toB;
                        }
                        
                        move(); // Start first trip
                        setInterval(move, 7000); // Repeat (6s travel + 1s rest)
                    }, 0);
                });
            } catch (error) { console.error("Loading error:", error); }
        }

        function addCity(name, x, y) {
            const id = `dot-${x}-${y}`;
            if (document.getElementById(id)) return;

            const dot = document.createElement('div');
            dot.className = 'city-dot';
            dot.id = id;
            dot.style.left = x + 'px';
            dot.style.top = y + 'px';
            container.appendChild(dot);

            const lbl = document.createElement('div');
            lbl.className = 'city-label'; 
            lbl.style.left = x + 'px'; 
            lbl.style.top = (y + 12) + 'px';
            lbl.innerText = name; 
            container.appendChild(lbl);
        }

        // Initialize
        drawNetwork();

        // ONLY refresh data every 5 minutes to prevent the "Stopping" glitch
        // When it refreshes, it will rebuild the planes.
        setInterval(drawNetwork, 1000); 
    </script>
</body>
</html>
